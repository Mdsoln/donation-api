<div class="container mt-4">
  <div class="card">
    <div class="card-header bg-primary text-white">
      <h2>Hospital Donation Report</h2>
    </div>
    <div class="card-body">
      <form [formGroup]="reportForm" (ngSubmit)="generateReport()">
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="reportType" class="form-label">Report Type</label>
            <select id="reportType" formControlName="reportType" class="form-select">
              <option value="QUARTERLY">Quarterly</option>
              <option value="YEARLY">Yearly</option>
              <option value="CUSTOM">Custom Date Range</option>
              <option value="ALL_TIME">All Time</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="reportFormat" class="form-label">Report Format</label>
            <select id="reportFormat" formControlName="reportFormat" class="form-select">
              <option value="JSON">JSON (View Online)</option>
              <option value="PDF">PDF</option>
              <option value="EXCEL">Excel</option>
            </select>
          </div>
        </div>

        <!-- Quarterly Report Options -->
        <div class="row mb-3" *ngIf="reportForm.get('reportType').value === 'QUARTERLY'">
          <div class="col-md-6">
            <label for="year" class="form-label">Year</label>
            <select id="year" formControlName="year" class="form-select">
              <option *ngFor="let year of years" [value]="year">{{ year }}</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="quarter" class="form-label">Quarter</label>
            <select id="quarter" formControlName="quarter" class="form-select">
              <option *ngFor="let quarter of quarters" [value]="quarter">Q{{ quarter }}</option>
            </select>
          </div>
        </div>

        <!-- Yearly Report Options -->
        <div class="row mb-3" *ngIf="reportForm.get('reportType').value === 'YEARLY'">
          <div class="col-md-6">
            <label for="yearOnly" class="form-label">Year</label>
            <select id="yearOnly" formControlName="yearOnly" class="form-select">
              <option *ngFor="let year of years" [value]="year">{{ year }}</option>
            </select>
          </div>
        </div>

        <!-- Custom Date Range Options -->
        <div class="row mb-3" *ngIf="reportForm.get('reportType').value === 'CUSTOM'">
          <div class="col-md-6">
            <label for="startDate" class="form-label">Start Date</label>
            <input type="date" id="startDate" formControlName="startDate" class="form-control">
          </div>
          <div class="col-md-6">
            <label for="endDate" class="form-label">End Date</label>
            <input type="date" id="endDate" formControlName="endDate" class="form-control">
          </div>
        </div>

        <!-- Additional Options -->
        <div class="row mb-3">
          <div class="col-md-6">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="includeBloodTypeDistribution" formControlName="includeBloodTypeDistribution">
              <label class="form-check-label" for="includeBloodTypeDistribution">
                Include Blood Type Distribution
              </label>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="includeHospitalComparison" formControlName="includeHospitalComparison">
              <label class="form-check-label" for="includeHospitalComparison">
                Include Hospital Comparison (Admin Only)
              </label>
            </div>
          </div>
        </div>

        <!-- Error Message -->
        <div class="alert alert-danger" *ngIf="error">{{ error }}</div>

        <!-- Buttons -->
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary" [disabled]="loading || reportForm.invalid">
            <span *ngIf="loading" class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
            Generate Report
          </button>
          <button type="button" class="btn btn-success" [disabled]="loading || reportForm.invalid" (click)="exportReport('PDF')">
            <i class="bi bi-file-pdf me-1"></i> Export as PDF
          </button>
          <button type="button" class="btn btn-success" [disabled]="loading || reportForm.invalid" (click)="exportReport('EXCEL')">
            <i class="bi bi-file-excel me-1"></i> Export as Excel
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Report Results -->
  <div class="card mt-4" *ngIf="reportData">
    <div class="card-header bg-success text-white">
      <h3>Report Results</h3>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <h4>Summary</h4>
          <table class="table table-bordered">
            <tbody>
              <tr>
                <th>Hospital</th>
                <td>{{ reportData.hospitalName }}</td>
              </tr>
              <tr>
                <th>Period</th>
                <td>{{ reportData.reportPeriod }}</td>
              </tr>
              <tr>
                <th>Total Donations</th>
                <td>{{ reportData.totalDonations }}</td>
              </tr>
              <tr>
                <th>Total Volume</th>
                <td>{{ reportData.totalVolumeMl | number:'1.2-2' }} ml</td>
              </tr>
              <tr>
                <th>Unique Donors</th>
                <td>{{ reportData.uniqueDonors }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <!-- Blood Type Distribution -->
        <div class="col-md-6" *ngIf="reportData.bloodTypeDistribution && reportData.bloodTypeDistribution.length > 0">
          <h4>Blood Type Distribution</h4>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Blood Type</th>
                <th>Count</th>
                <th>Percentage</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let bloodType of reportData.bloodTypeDistribution">
                <td>{{ bloodType.bloodType }}</td>
                <td>{{ bloodType.count }}</td>
                <td>{{ bloodType.percentage | number:'1.2-2' }}%</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Quarterly Data -->
      <div class="row mt-4" *ngIf="reportData.quarterlyData && reportData.quarterlyData.length > 0">
        <div class="col-12">
          <h4>Quarterly Breakdown</h4>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Quarter</th>
                <th>Donations</th>
                <th>Volume (ml)</th>
                <th>Donors</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let quarter of reportData.quarterlyData">
                <td>{{ quarter.quarter }}</td>
                <td>{{ quarter.donations }}</td>
                <td>{{ quarter.volumeMl | number:'1.2-2' }}</td>
                <td>{{ quarter.donors }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>